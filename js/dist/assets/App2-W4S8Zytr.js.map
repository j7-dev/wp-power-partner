{"version":3,"file":"App2-W4S8Zytr.js","sources":["../../src/pages/UserApp/atom.tsx","../../src/pages/UserApp/SiteList/index.tsx","../../src/pages/UserApp/hooks/useGetUserIdentity.tsx","../../src/pages/UserApp/index.tsx","../../src/App2.tsx"],"sourcesContent":["import { atom } from 'jotai'\r\nimport { TIdentity } from '@/pages/UserApp/types'\r\n\r\nexport const defaultIdentity: TIdentity = {\r\n  status: 100,\r\n  message: 'un-login',\r\n  data: null,\r\n}\r\n\r\nexport const identityAtom = atom<TIdentity>(defaultIdentity)\r\n\r\nexport const globalLoadingAtom = atom({\r\n  isLoading: false,\r\n  label: '',\r\n})\r\n","import { SiteListTable, DataType } from '@/components/SiteListTable'\r\nimport { TSiteExtraParams } from './types'\r\nimport { identityAtom, globalLoadingAtom } from '@/pages/UserApp/atom'\r\nimport { useAtomValue, useSetAtom } from 'jotai'\r\nimport { useTable } from '@/hooks'\r\nimport { useEffect } from 'react'\r\nimport { currentUserId } from '@/utils'\r\n\r\nconst index = () => {\r\n  const identity = useAtomValue(identityAtom)\r\n  const setGlobalLoading = useSetAtom(globalLoadingAtom)\r\n\r\n  const partner_id = identity.data?.partner_id || ''\r\n\r\n  const { tableProps, result } = useTable<TSiteExtraParams, DataType>({\r\n    resource: 'apps',\r\n    defaultParams: {\r\n      user_id: partner_id,\r\n      customer_id: currentUserId.toString(),\r\n    },\r\n    queryOptions: {\r\n      enabled: !!partner_id && !!currentUserId,\r\n    },\r\n  })\r\n\r\n  useEffect(() => {\r\n    if (!result?.isFetching) {\r\n      setGlobalLoading({\r\n        isLoading: false,\r\n        label: '',\r\n      })\r\n    }\r\n  }, [result?.isFetching])\r\n\r\n  return <SiteListTable tableProps={tableProps} />\r\n}\r\n\r\nexport default index\r\n","import { axios } from '@/api'\r\nimport { identityAtom, globalLoadingAtom } from '@/pages/UserApp/atom'\r\nimport { useSetAtom } from 'jotai'\r\nimport { notification } from 'antd'\r\nimport { renderHTML } from '@/utils'\r\nimport { TIdentity } from '@/pages/UserApp/types'\r\nimport { useQuery } from '@tanstack/react-query'\r\nimport { AxiosResponse } from 'axios'\r\n\r\nexport const useGetUserIdentity = () => {\r\n  const setIdentity = useSetAtom(identityAtom)\r\n  const setGlobalLoading = useSetAtom(globalLoadingAtom)\r\n\r\n  const result = useQuery<AxiosResponse<TIdentity>>({\r\n    queryKey: ['identity'],\r\n    queryFn: () => {\r\n      setGlobalLoading({\r\n        isLoading: true,\r\n        label: '正在獲取用戶資料...',\r\n      })\r\n\r\n      return axios.get('/power-partner/partner-id')\r\n    },\r\n    onError: (err) => {\r\n      console.log('err', err)\r\n    },\r\n    onSuccess: (res) => {\r\n      const theIdentity = res?.data as TIdentity\r\n      setIdentity(theIdentity)\r\n      if (theIdentity?.status !== 200) {\r\n        notification.error({\r\n          message: theIdentity?.message,\r\n          description: renderHTML(JSON.stringify(theIdentity?.data || '')),\r\n        })\r\n      }\r\n    },\r\n    staleTime: 1000 * 60 * 60 * 24,\r\n    cacheTime: 1000 * 60 * 60 * 24,\r\n  })\r\n\r\n  return result\r\n}\r\n","import SiteList from '@/pages/UserApp/SiteList'\r\nimport { useGetUserIdentity } from '@/pages/UserApp/hooks/useGetUserIdentity'\r\nimport { currentUserId } from '@/utils'\r\nimport { globalLoadingAtom, identityAtom } from '@/pages/UserApp/atom'\r\nimport { useAtomValue } from 'jotai'\r\nimport { Spin } from 'antd'\r\n\r\nconst index = () => {\r\n  const { isLoading } = useGetUserIdentity()\r\n\r\n  if (!currentUserId) {\r\n    return <p>請先登入以便查看站台資訊</p>\r\n  }\r\n\r\n  const globalLoading = useAtomValue(globalLoadingAtom)\r\n  const identity = useAtomValue(identityAtom)\r\n  const identityData = identity?.data\r\n  const status = identity?.status\r\n\r\n  return (\r\n    <div className=\"flex min-h-[12rem]\">\r\n      <Spin\r\n        size=\"large\"\r\n        wrapperClassName=\"w-full\"\r\n        spinning={globalLoading?.isLoading || isLoading}\r\n        tip={globalLoading?.isLoading ? globalLoading?.label : 'Loading...'}\r\n      >\r\n        {status === 200 && identityData && <SiteList />}\r\n\r\n        {(status === 500 || !identityData) && (\r\n          <p>OOPS! something went wrong! </p>\r\n        )}\r\n      </Spin>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default index\r\n","import '@/assets/scss/index.scss'\r\nimport UserApp from '@/pages/UserApp'\r\n\r\nfunction App2() {\r\n  return <UserApp />\r\n}\r\n\r\nexport default App2\r\n"],"names":["defaultIdentity","status","message","data","identityAtom","globalThis","jotaiAtomCache","get","atom","debugLabel","globalLoadingAtom","isLoading","label","index","identity","useAtomValue","setGlobalLoading","useSetAtom","partner_id","tableProps","result","useTable","resource","defaultParams","user_id","customer_id","currentUserId","toString","queryOptions","enabled","useEffect","isFetching","jsx","SiteListTable","useGetUserIdentity","setIdentity","useQuery","queryKey","queryFn","axios","onError","err","log","onSuccess","res","theIdentity","notification","error","description","renderHTML","JSON","stringify","staleTime","cacheTime","globalLoading","identityData","jsxs","Spin","SiteList","App2","UserApp"],"mappings":"8TAGO,MAAMA,EAA6B,CACxCC,OAAQ,IACRC,QAAS,WACTC,KAAM,IACR,EAEAC,EAAAC,WAAAC,eAAAC,IAA4BC,8GAAAA,EAAgBR,CAAe,CAAC,EAAAI,EAAAK,WAAA,eAE5DC,MAAAA,EAAAL,WAAAC,eAAAC,IAAiCC,mHAAAA,EAAK,CACpCG,UAAW,GACXC,MAAO,EACT,CAAC,CAAC,EAAAF,EAAAD,WAAA,sKCNF,MAAMI,EAAQA,IAAM,OACZC,MAAAA,EAAWC,EAAaX,CAAY,EACpCY,EAAmBC,EAAWP,CAAiB,EAE/CQ,IAAaJ,EAAAA,EAASX,OAATW,YAAAA,EAAeI,aAAc,GAE1C,CAAEC,WAAAA,EAAYC,OAAAA,GAAWC,EAAqC,CAClEC,SAAU,OACVC,cAAe,CACbC,QAASN,EACTO,YAAaC,EAAcC,SAAS,CACtC,EACAC,aAAc,CACZC,QAAS,CAAC,CAACX,GAAc,CAAC,CAACQ,CAC7B,CAAA,CACD,EAEDI,OAAAA,EAAAA,UAAU,IAAM,CACTV,GAAAA,MAAAA,EAAQW,YACMf,EAAA,CACfL,UAAW,GACXC,MAAO,EAAA,CACR,CACH,EACC,CAACQ,GAAAA,YAAAA,EAAQW,UAAU,CAAC,EAEhBC,EAACC,GAAc,WAAAd,CAA0B,CAAA,CAClD,oJC1BO,MAAMe,EAAqBA,IAAM,CAChCC,MAAAA,EAAclB,EAAWb,CAAY,EACrCY,EAAmBC,EAAWP,CAAiB,EA6B9CU,OA3BQgB,EAAmC,CAChDC,SAAU,CAAC,UAAU,EACrBC,QAASA,KACUtB,EAAA,CACfL,UAAW,GACXC,MAAO,aAAA,CACR,EAEM2B,EAAMhC,IAAI,2BAA2B,GAE9CiC,QAAkBC,GAAA,CACRC,QAAAA,IAAI,MAAOD,CAAG,CACxB,EACAE,UAAoBC,GAAA,CAClB,MAAMC,EAAcD,GAAAA,YAAAA,EAAKzC,KACzBgC,EAAYU,CAAW,GACnBA,GAAAA,YAAAA,EAAa5C,UAAW,KAC1B6C,EAAaC,MAAM,CACjB7C,QAAS2C,GAAAA,YAAAA,EAAa3C,QACtB8C,YAAaC,EAAWC,KAAKC,WAAUN,GAAAA,YAAAA,EAAa1C,OAAQ,EAAE,CAAC,CAAA,CAChE,CAEL,EACAiD,UAAW,IAAO,GAAK,GAAK,GAC5BC,UAAW,IAAO,GAAK,GAAK,EAAA,CAC7B,CAGH,oJClCA,MAAMxC,EAAQA,IAAM,CACZ,KAAA,CAAEF,UAAAA,GAAcuB,EAAmB,EAEzC,GAAI,CAACR,EACI,OAAAM,EAAC,KAAE,SAAY,cAAA,CAAA,EAGlBsB,MAAAA,EAAgBvC,EAAaL,CAAiB,EAC9CI,EAAWC,EAAaX,CAAY,EACpCmD,EAAezC,GAAAA,YAAAA,EAAUX,KACzBF,EAASa,GAAAA,YAAAA,EAAUb,OAEzB,SACG,MAAI,CAAA,UAAU,qBACb,SAACuD,EAAAC,EAAA,CACC,KAAK,QACL,iBAAiB,SACjB,UAAUH,GAAAA,YAAAA,EAAe3C,YAAaA,EACtC,IAAK2C,GAAAA,MAAAA,EAAe3C,UAAY2C,GAAAA,YAAAA,EAAe1C,MAAQ,aAEtDX,SAAAA,CAAWA,IAAA,KAAOsD,GAAgBvB,EAAC0B,EAAQ,CAAA,CAAA,GAE1CzD,IAAW,KAAO,CAACsD,IACnBvB,EAAC,KAAE,SAA4B,+BAAA,CAAA,CAEnC,CAAA,CACF,CAAA,CAEJ,oJChCA,SAAS2B,GAAO,CACd,SAAQC,EAAU,CAAA,CAAA,CACpB"}